"use strict";(self["webpackChunkjiang_blog"]=self["webpackChunkjiang_blog"]||[]).push([[210],{8210:function(e,t,a){a.r(t),a.d(t,{default:function(){return F}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"admin"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"修改密码",name:"first"}},[t("div",{staticClass:"admin-password"},[e._v(" 新密码： "),t("el-input",{staticClass:"input",attrs:{type:"text",placeholder:"请输入新密码"},model:{value:e.rootPass,callback:function(t){e.rootPass=t},expression:"rootPass"}})],1),t("el-button",{attrs:{type:"primary"},on:{click:e.changeRootPassword}},[e._v("确认修改")])],1),t("el-tab-pane",{attrs:{label:"友链管理",name:"second"}},[t("LinkBase")],1),t("el-tab-pane",{attrs:{label:"发表文章",name:"third"}},[t("ArticleBase")],1),t("el-tab-pane",{attrs:{label:"文章管理",name:"fourth"}},[t("ArticleManager")],1)],1)],1)},l=[],i=a(9158),r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"link-base"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[t("el-table-column",{attrs:{label:"博客名",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.blogName))])]}}])}),t("el-table-column",{attrs:{label:"博客地址",width:"240"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.blogOrigin))])]}}])}),t("el-table-column",{attrs:{label:"博客logo地址",width:"320"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.blogLogo))])]}}])}),t("el-table-column",{attrs:{label:"博客简述",width:"260"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.blogMessage))])]}}])}),t("el-table-column",{attrs:{label:"更改推荐状态",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.blogHotLink))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("是否推荐")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1)],1)},o=[],n={name:"LinkBase",data(){return{tableData:[]}},created(){this.getAllLinks()},methods:{async handleEdit(e){e.blogHotLink=!e.blogHotLink;const t=await(0,i.c3)({_id:e._id,blogHotLink:e.blogHotLink});console.log(t)},async handleDelete(e){console.log(e);const{data:t}=await(0,i.Yw)({params:{id:e._id}});if(!t.code)return this.$message.warning(t.message);this.$message.success(t.message),this.tableData=this.tableData.filter((t=>t._id!==e._id))},async getAllLinks(){const{data:e}=await(0,i.lk)();this.tableData.push(...e.data)}}},c=n,u=a(1001),m=(0,u.Z)(c,r,o,!1,null,null,null),d=m.exports,g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"article-base"},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文章标题",prop:"name"}},[t("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"文章简述",prop:"region"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.region,callback:function(t){e.$set(e.ruleForm,"region",t)},expression:"ruleForm.region"}})],1),t("el-form-item",{attrs:{label:"上传文档",prop:"type"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{drag:"",limit:1,action:"/root/uploadFile",multiple:"","on-success":e.updateFile,"before-upload":e.judgeFileType,"on-remove":e.deleteChoosedFile}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])])])],1),t("el-form-item",{attrs:{label:"上传封面",prop:"resource"}},[t("el-upload",{ref:"image",staticClass:"avatar-uploader",attrs:{drag:"",limit:1,action:"/root/uploadArticleImg","on-success":e.updateActicleImg,"on-remove":e.deleteChoosedImg}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:"/"+e.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("立即发表")])],1)],1)],1)},p=[],h={name:"ArticleBase",data(){return{ruleForm:{name:"",region:""},rules:{name:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:3,max:12,message:"长度在 3 到 12 个字符",trigger:"blur"}],region:[{required:!0,message:"请输入文章简述",trigger:"blur"}]},imageUrl:"",fileUrl:{},articleImgUrl:{}}},beforeDestory(){},methods:{submitForm(e){this.$refs[e].validate((async e=>{if(!e)return console.log("error submit!!"),!1;{const{data:e}=await(0,i.fO)({articleTitle:this.ruleForm.name,articleDesc:this.ruleForm.region,articleFileUrl:this.fileUrl.url,articleImgUrl:this.articleImgUrl.url,articleDate:new Date});if(!e.code)return this.$message.error(e.message);this.$message.success(e.message),this.$refs.file.clearFiles(),this.$refs.image.clearFiles(),this.fileUrl={},this.articleImgUrl={},this.imageUrl=""}}))},updateFile(e,t,a){e.code?(this.$message.success(e.message),this.fileUrl=e.data):this.$message.error(e.message)},judgeFileType(e){e.name.endsWith(".txt")&&e.name.endsWith(".md")||this.$refs.file.abort()},async deleteChoosedFile(){console.log(this.fileUrl.path);const{data:e}=await(0,i._I)({path:this.fileUrl.path});this.$message.success(e.message)},updateActicleImg(e,t,a){e.code?(this.$message.success(e.message),this.articleImgUrl=e.data,this.imageUrl=e.data.url):this.$message.error(e.message)},async deleteChoosedImg(){const{data:e}=await(0,i._Y)({path:this.articleImgUrl.path});this.$message.success(e.message)}}},f=h,b=(0,u.Z)(f,g,p,!1,null,"7f3d5019",null),w=b.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"article-manager"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[t("el-table-column",{attrs:{label:"文章标题",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[t("el-input",{attrs:{type:"text",disabled:a.row.isDisable,autocomplete:"off"},model:{value:a.row.articleTitle,callback:function(t){e.$set(a.row,"articleTitle",t)},expression:"scope.row.articleTitle"}})],1)]}}])}),t("el-table-column",{attrs:{label:"文章简介",width:"320"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"margin-left":"10px"}},[t("el-input",{attrs:{type:"textarea",disabled:a.row.isDisable,autocomplete:"off"},model:{value:a.row.articleDesc,callback:function(t){e.$set(a.row,"articleDesc",t)},expression:"scope.row.articleDesc"}})],1)]}}])}),t("el-table-column",{attrs:{label:"修改文章",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isDisable?t("el-button",{attrs:{size:"mini"},on:{click:function(e){a.row.isDisable=!1}}},[e._v("修改文章")]):t("div",{staticClass:"botton-two"},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.submitArticleChange(a.row),a.row.isDisable=!0}}},[e._v("提交修改")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancelArticleChange(a.row)}}},[e._v("取消修改")])],1)]}}])}),t("el-table-column",{attrs:{label:"文章封面",width:"240"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("img",{staticStyle:{width:"150px"},attrs:{src:`${a.row.articleImgUrl}`,alt:""}}),t("el-upload",{staticClass:"upload-demo",attrs:{action:"/root/reviseArticleImg",data:{articleImgUrl:a.row.articleImgUrl,id:a.row._id},"on-success":function(t){e.updateActicleImg(t,a.row)},"on-remove":function(t){e.deleteChoosedImg(t,a.row)},limit:1}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 只能上传jpg/png文件，且不超过500kb ")])],1)]}}])}),t("el-table-column",{attrs:{label:"文章内容文件",width:"260"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.routerToArticleContent(a.row)}}},[e._v("修改文章内容")])]}}])}),t("el-table-column",{attrs:{label:"推荐状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.articleHot?t("el-result",{attrs:{icon:"success"}}):t("el-result",{attrs:{icon:"error"}})]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("是否推荐")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"page-size":2,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)},v=[],y={name:"ArticleManager",data(){return{tableData:[],originData:[],total:0}},created(){this.getAllArticle()},methods:{async getAllArticle(e=1){const{data:t}=await(0,i.DA)(e);console.log(t),t.result.data.forEach((e=>{e.isDisable=!0})),this.total=t.result.total,this.tableData=t.result.data,this.originData=this.tableData.slice(0)},async submitArticleChange({articleDesc:e,articleTitle:t,_id:a}){const{data:s}=await(0,i.ac)({articleDesc:e,articleTitle:t,_id:a});this.$message.success(s.message)},cancelArticleChange(e){e.isDisable=!0,this.tableData=this.originData.slice(0)},async handleEdit(e){e.articleHot=!e.articleHot;const{data:t}=await(0,i.q2)(e);if(!t.code)return this.$message.error(t.message);this.$message.success(t.message)},handleDelete({_id:e}){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const{data:t}=await(0,i.jX)(e);this.$message.success(t.message),this.getAllArticle()})).catch((()=>{this.$message("已取消删除")}))},updateActicleImg(e,t){t.articleImgUrl=e.data.url,console.log(e,t),e.code?this.$message.success(e.message):this.$message.error(e.message)},async deleteChoosedImg(e,t){console.log(t);const{data:a}=await(0,i._Y)({path:e.response.data.path});t.articleImgUrl="/img/avatar.png",this.$message.success("删除图片成功")},handleCurrentChange(e){this.getAllArticle(e)},routerToArticleContent(e){this.$router.push({name:"ArticleContent",params:{id:e.articleFileUrl}})}}},k=y,C=(0,u.Z)(k,_,v,!1,null,"94c18cbe",null),D=C.exports,$={name:"Admin",data(){return{activeName:"fourth",rootPass:""}},created(){this.$store.commit("hideLeftSider",!1)},methods:{async changeRootPassword(){const{data:e}=await(0,i.xi)({rootPass:this.rootPass});this.$message.success(e.message)}},beforeRouteLeave(e,t,a){this.$store.commit("hideLeftSider",!0),a()},components:{LinkBase:d,ArticleBase:w,ArticleManager:D}},A=$,x=(0,u.Z)(A,s,l,!1,null,"6f6c3350",null),F=x.exports}}]);
//# sourceMappingURL=210.b1436f12.js.map