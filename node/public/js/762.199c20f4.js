"use strict";(self["webpackChunkjiang_blog"]=self["webpackChunkjiang_blog"]||[]).push([[762],{9762:function(e,r,s){s.r(r),s.d(r,{default:function(){return $}});var t=function(){var e=this,r=e._self._c;return r("div",{staticClass:"user-information"},[r("h3",{staticClass:"border-left"},[e._v("修改资料")]),r("div",{staticClass:"user-information-tab"},[r("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(r){e.activeName=r},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"用户名",name:"first"}},[r("UserName")],1),r("el-tab-pane",{attrs:{label:"密码",name:"second"}},[r("Password")],1),r("el-tab-pane",{attrs:{label:"头像",name:"third"}},[r("div",{staticClass:"user-information-tab-avatar"},[r("el-alert",{attrs:{title:"点击上传图片修改头像",type:"warning","show-icon":""}}),r("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/blog/changeAvatar",data:{id:e.$store.state.userInfo._id},"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.imageUrl?r("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)])],1)],1)])},a=[],o=function(){var e=this,r=e._self._c;return r("div",{staticClass:"username"},[r("p",[e._v("原用户名："),r("span",[e._v(e._s(e.$store.state.userInfo.username))])]),r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"50px"}},[r("el-form-item",{attrs:{label:"新用户名：",prop:"username"}},[r("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.ruleForm.username,callback:function(r){e.$set(e.ruleForm,"username","string"===typeof r?r.trim():r)},expression:"ruleForm.username"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitForm("ruleForm")}}},[e._v("修改")])],1)],1)],1)},l=[],i=(s(1703),s(9158)),n={name:"Username",data(){let e=(e,r,s)=>""===r?s(new Error("用户名不能为空")):r===this.$store.state.userInfo.username?s(new Error("与原用户名一致，无需更改")):void s();return{ruleForm:{username:"",id:this.$store.state.userInfo._id},rules:{username:[{validator:e,trigger:"blur"}]}}},methods:{submitForm(e){this.$refs[e].validate((async e=>{if(!e)return!1;{const{data:e}=await(0,i.qr)(this.ruleForm);console.log(e),e.code?(this.$store.commit("setUserInfo",e.data),this.$message.success("更改用户名成功")):this.$message.success("该用户不存在，无法修改用户名")}}))}}},u=n,m=s(1001),d=(0,m.Z)(u,o,l,!1,null,"490ba8f8",null),c=d.exports,f=function(){var e=this,r=e._self._c;return r("div",{staticClass:"password"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"50px"}},[r("el-form-item",{attrs:{label:"原密码",prop:"oldPassword"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm.oldPassword,callback:function(r){e.$set(e.ruleForm,"oldPassword",r)},expression:"ruleForm.oldPassword"}})],1),r("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm.newPassword,callback:function(r){e.$set(e.ruleForm,"newPassword",r)},expression:"ruleForm.newPassword"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm.confirmPassword,callback:function(r){e.$set(e.ruleForm,"confirmPassword",r)},expression:"ruleForm.confirmPassword"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitForm("ruleForm")}}},[e._v("更改密码")])],1)],1)],1)},p=[],w={name:"Password",data(){let e=/^[\w]{6,12}$/,r=(r,s,t)=>""===s?t(new Error("密码不能为空")):e.test(s)?s!==this.$store.state.userInfo.password?t(new Error("密码错误")):void t():t(new Error("请输入6-12个字符")),s=(r,s,t)=>""===s?t(new Error("密码不能为空")):s===this.ruleForm.oldPassword?t(new Error("新密码与原密码相同，无需修改")):e.test(s)?void t():t(new Error("请输入6-12个字符")),t=(r,s,t)=>""===s?t(new Error("密码不能为空")):s!==this.ruleForm.newPassword?t(new Error("两次密码不一致，请重新输入")):e.test(s)?void t():t(new Error("请输入6-12个字符"));return{ruleForm:{oldPassword:"",newPassword:"",confirmPassword:""},rules:{oldPassword:[{validator:r,trigger:"blur"}],newPassword:[{validator:s,trigger:"blur"}],confirmPassword:[{validator:t,trigger:"blur"}]},id:this.$store.state.userInfo._id}},methods:{submitForm(e){this.$refs[e].validate((async e=>{if(!e)return!1;{this.ruleForm.id=this.id;const{data:e}=await(0,i.yo)(this.ruleForm);if(!e.code)return this.$message.error("未登录账号，无需修改密码操作");this.$message.success("密码更改成功"),this.$store.commit("setUserInfo",e.data)}}))}}},b=w,v=(0,m.Z)(b,f,p,!1,null,"dee2f2a8",null),h=v.exports,g={name:"UserInformation",data(){return{activeName:"first",imageUrl:""}},methods:{async handleAvatarSuccess(e,r){this.imageUrl=URL.createObjectURL(r.raw),this.$store.commit("setUserInfo",e.data)},beforeAvatarUpload(e){const r="image/jpeg"===e.type||"image/png"===e.type,s=e.size/1024/1024<2;return r||this.$message.error("上传头像图片只能是 JPG或PNG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),r&&s}},components:{UserName:c,Password:h}},F=g,P=(0,m.Z)(F,t,a,!1,null,null,null),$=P.exports}}]);
//# sourceMappingURL=762.199c20f4.js.map